#!/bin/sh

PATH=$PATH:$(dirname $0):$(dirname $0)/../bin

CONTEST="${1:-OK1WC}"
EXTX="${2:-}"
LOG="${3:-$(date +%F)-$(echo $CONTEST | tr 'A-Z/ ' 'a-z__').log}"
CBR="${LOG%.*}.cbr"

[ -f "$LOG" ] || mv contest.log "$LOG"

set -eux

import-tlf ${EXTX:+-e "$EXTX"} -n "$CONTEST" "$LOG"
read ok
import-tlf ${EXTX:+-e "$EXTX"} "$CONTEST" "$LOG"

git add $LOG
export-cabrillo "$CONTEST" "$CBR"
vi $CBR
git add $CBR
v commit -m "$CONTEST" --edit
